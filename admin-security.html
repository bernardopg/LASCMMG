<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Segurança - Administração de Torneios</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/faculdade-theme.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="css/visual-improvements.css" />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/security-stats.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <meta
      name="description"
      content="Monitoramento de segurança para o sistema de gerenciamento de torneios"
    />
  </head>
  <body>
    <!-- Sidebar com o mesmo padrão do admin.html -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>Segurança</h1>
        <button
          id="toggle-sidebar-btn"
          class="toggle-sidebar-btn"
          aria-label="Alternar menu"
        >
          ☰
        </button>
      </div>
      <div class="sidebar-content">
        <nav class="sidebar-nav">
          <ul class="sidebar-nav-main">
            <li>
              <a href="admin.html" class="nav-item">
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M3,13H11V3H3V13M3,21H11V15H3V21M13,21H21V11H13V21M13,3V9H21V3H13Z"
                  ></path>
                </svg>
                <span>Painel Administrativo</span>
              </a>
            </li>
            <li>
              <button
                id="menu-security-overview"
                class="nav-item active"
                aria-pressed="true"
              >
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M12,12H19C18.47,16.11 15.72,19.78 12,20.92V12H5V6.3L12,3.19M12,1L3,5V11C3,16.55 6.84,21.73 12,23C17.16,21.73 21,16.55 21,11V5L12,1Z"
                  ></path>
                </svg>
                <span>Visão Geral</span>
              </button>
            </li>
            <li>
              <button
                id="menu-honeypots"
                class="nav-item"
                aria-pressed="false"
              >
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1Z"
                  ></path>
                </svg>
                <span>Honeypots</span>
              </button>
            </li>
            <li>
              <button
                id="menu-threat-analytics"
                class="nav-item"
                aria-pressed="false"
              >
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z"
                  ></path>
                </svg>
                <span>Análise de Ameaças</span>
              </button>
            </li>
            <li>
              <button
                id="menu-blocked-ips"
                class="nav-item"
                aria-pressed="false"
              >
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M15.5,7L14,8.5L11.5,6L10,7.5L12.5,10L10,12.5L11.5,14L14,11.5L16.5,14L18,12.5L15.5,10L18,7.5L16.5,7Z"
                  ></path>
                </svg>
                <span>IPs Bloqueados</span>
              </button>
            </li>
          </ul>
        </nav>
        <div class="sidebar-nav-bottom">
          <nav class="sidebar-nav">
            <ul>
              <li>
                <a href="admin.html" class="nav-item">
                  <svg class="icon" viewBox="0 0 24 24">
                    <path
                      d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"
                    ></path>
                  </svg>
                  <span>Voltar ao Admin</span>
                </a>
              </li>
              <li>
                <button id="logout-btn" class="nav-item">
                  <svg class="icon" viewBox="0 0 24 24">
                    <path
                      d="M16,17V14H9V10H16V7L21,12L16,17M14,2A2,2 0 0,1 16,4V6H14V4H5V20H14V18H16V20A2,2 0 0,1 14,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H14Z"
                    ></path>
                  </svg>
                  <span>Sair</span>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </aside>

    <div class="content-wrapper">
      <header class="mobile-header">
        <button
          id="mobile-sidebar-toggle"
          class="toggle-sidebar-btn"
          aria-label="Abrir menu"
        >
          ☰
        </button>
        <h1>Segurança - Torneio de Sinuca</h1>
      </header>

      <div id="message-container" role="alert" aria-live="assertive"></div>

      <div class="admin-section hidden-section" id="login-section">
        <!-- Seção de login (igual ao admin.html) -->
        <h1>Login Administrativo</h1>
        <form id="login-form">
          <div class="form-group">
            <label for="username">Usuário:</label>
            <input
              type="text"
              id="username"
              name="username"
              required
              autocomplete="username"
            />
          </div>
          <div class="form-group">
            <label for="password">Senha:</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              autocomplete="current-password"
            />
          </div>
          <button type="submit" class="btn btn-primary">Entrar</button>
        </form>
      </div>

      <div class="admin-section" id="security-dashboard">
        <!-- Breadcrumbs para navegação -->
        <nav class="breadcrumbs" aria-label="Navegação estrutural">
          <a href="index.html">Início</a> >
          <a href="admin.html">Admin</a> >
          <span>Segurança</span>
        </nav>

        <main>
          <!-- Seção de Visão Geral de Segurança -->
          <section
            id="section-security-overview"
            class="admin-section-content active-content"
            aria-live="polite"
            role="region"
            aria-labelledby="security-overview-heading"
          >
            <h2 id="security-overview-heading">Visão Geral de Segurança</h2>

            <div id="security-stats-container" class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Resumo de Ameaças Detectadas</h3>
                <button id="refresh-security-stats" class="btn-refresh">
                  <svg class="icon" viewBox="0 0 24 24">
                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                  </svg>
                  Atualizar
                </button>
              </div>

              <div class="stats-cards">
                <div class="stats-card primary">
                  <div class="stats-card-title">Total de Eventos</div>
                  <div id="total-threat-events" class="stats-card-value">0</div>
                  <div class="stats-card-subtitle">tentativas detectadas</div>
                </div>

                <div class="stats-card secondary">
                  <div class="stats-card-title">IPs Únicos</div>
                  <div id="unique-threat-ips" class="stats-card-value">0</div>
                  <div class="stats-card-subtitle">endereços distintos</div>
                </div>

                <div class="stats-card warning">
                  <div class="stats-card-title">Padrões de Ataque</div>
                  <div id="unique-attack-patterns" class="stats-card-value">0</div>
                  <div class="stats-card-subtitle">tipos detectados</div>
                </div>
              </div>

              <div class="chart-container">
                <canvas id="attack-patterns-chart"></canvas>
              </div>

              <span id="security-stats-last-updated" class="last-updated">Última atualização: Nunca</span>
            </div>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Atividades Suspeitas Recentes</h3>
              </div>

              <table class="threat-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Endereço IP</th>
                    <th>Eventos</th>
                    <th>Última Detecção</th>
                    <th>Padrões Detectados</th>
                  </tr>
                </thead>
                <tbody id="threat-stats-table-body">
                  <tr>
                    <td colspan="5" class="text-center">Carregando dados de ameaças...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- Seção de Honeypots -->
          <section
            id="section-honeypots"
            class="admin-section-content hidden-content"
            aria-live="polite"
            role="region"
            aria-labelledby="honeypots-heading"
          >
            <h2 id="honeypots-heading">Honeypots Ativos</h2>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Endpoints Honeypot Ativos</h3>
                <p>Endpoints falsos que detectam e registram tentativas de acesso</p>
              </div>

              <div id="honeypot-list-container">
                <p class="text-center">Carregando lista de honeypots...</p>
              </div>
            </div>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Configuração de Honeypots</h3>
              </div>

              <form id="honeypot-config-form">
                <div class="form-group">
                  <label for="honeypot-threshold">Limite para Bloqueio:</label>
                  <input type="number" id="honeypot-threshold" min="1" max="20" value="3" />
                  <small>Número de tentativas antes de bloquear um IP</small>
                </div>

                <div class="form-group">
                  <label for="honeypot-block-duration">Duração do Bloqueio (horas):</label>
                  <input type="number" id="honeypot-block-duration" min="1" max="72" value="6" />
                  <small>Tempo que um IP ficará bloqueado após detectar atividade suspeita</small>
                </div>

                <div class="form-group">
                  <label for="honeypot-whitelist">IPs na Whitelist (um por linha):</label>
                  <textarea id="honeypot-whitelist" rows="4" placeholder="127.0.0.1
192.168.1.1">127.0.0.1</textarea>
                  <small>IPs que nunca serão bloqueados (ex: administradores, servidores confiáveis)</small>
                </div>

                <button type="submit" class="btn btn-primary">Salvar Configuração</button>
              </form>
            </div>
          </section>

          <!-- Seção de Análise de Ameaças -->
          <section
            id="section-threat-analytics"
            class="admin-section-content hidden-content"
            aria-live="polite"
            role="region"
            aria-labelledby="threat-analytics-heading"
          >
            <h2 id="threat-analytics-heading">Análise de Ameaças</h2>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Distribuição de Padrões de Ataque</h3>
              </div>

              <div class="chart-container">
                <canvas id="attack-patterns-distribution-chart"></canvas>
              </div>
            </div>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Atividade ao Longo do Tempo</h3>
              </div>

              <div class="chart-container">
                <canvas id="threat-timeline-chart"></canvas>
              </div>
            </div>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Distribuição Geográfica</h3>
                <p>Mapa de calor de origens de atividade suspeita</p>
              </div>

              <div id="threat-geo-map" style="height: 400px; background-color: #f5f5f5; display: flex; align-items: center; justify-content: center;">
                <p>Carregando mapa de ameaças...</p>
                <!-- Aqui seria integrado um mapa interativo (implementação futura) -->
              </div>
            </div>
          </section>

          <!-- Seção de IPs Bloqueados -->
          <section
            id="section-blocked-ips"
            class="admin-section-content hidden-content"
            aria-live="polite"
            role="region"
            aria-labelledby="blocked-ips-heading"
          >
            <h2 id="blocked-ips-heading">IPs Bloqueados</h2>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Lista de Bloqueio Ativa</h3>
                <button id="refresh-blocklist" class="btn-refresh">
                  <svg class="icon" viewBox="0 0 24 24">
                    <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                  </svg>
                  Atualizar
                </button>
              </div>

              <table class="threat-table">
                <thead>
                  <tr>
                    <th>IP</th>
                    <th>Bloqueado Desde</th>
                    <th>Bloqueado Até</th>
                    <th>Motivo</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="blocked-ips-table-body">
                  <tr>
                    <td colspan="5" class="text-center">Nenhum IP bloqueado atualmente</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="security-section">
              <div class="security-section-header">
                <h3 class="security-section-title">Adicionar Bloqueio Manual</h3>
              </div>

              <form id="manual-block-form">
                <div class="form-group">
                  <label for="manual-block-ip">Endereço IP:</label>
                  <input type="text" id="manual-block-ip" required pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" placeholder="192.168.1.1" />
                  <small>Formato IPv4 (ex: 192.168.1.1)</small>
                </div>

                <div class="form-group">
                  <label for="manual-block-duration">Duração (horas):</label>
                  <input type="number" id="manual-block-duration" min="1" max="720" value="24" />
                  <small>Tempo que o IP ficará bloqueado</small>
                </div>

                <div class="form-group">
                  <label for="manual-block-reason">Motivo:</label>
                  <input type="text" id="manual-block-reason" required placeholder="Tentativa de acesso não autorizado" />
                </div>

                <button type="submit" class="btn btn-primary">Bloquear IP</button>
              </form>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- Carregar scripts -->
    <script type="module" src="js/adminApp.js"></script>
    <script type="module" src="js/admin/securityStatsHandler.js"></script>
  </body>
</html>
